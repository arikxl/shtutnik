import { NextResponse } from 'next/server';

export async function POST(request: Request) {
    try {

        const exampleQuestions = [
            "תן רוטב נפוץ לסושי",
            "תני מילה נרדפת ל\"שמיים\"?",
            "ספרי במשפט אחד את הסיפור של כיפה אדומה",
            "תן שם של כוכב במערכת השמש",
            "איך מנצחים במטקות?",
            "כמה יבשות יש?",
            "איך מכינים קרח?",
            "\"עוגה עוגה עוגה, במעגל...\"?",
            "איך קוראים לאשתו של הגמל?",
            "מה אייזיק ניוטון גילה?",
            "איזו תכונה מאפיינת חמור?",
            "עם מה משקים עציצים?",
            "מה החוק השני של התרמודינמיקה?",
            "כמה צלעות יש במתומן?",
            "על מה זכתה עדה יונת בפרס נובל?",
            "מה ראשי התיבות ממ\"ד?",
            "מי זכה במונדיאל האחרון?",
            "מה השם האמיתי של ליידי גאגא?",
            "איך קוראים לחבר של אדון שוקו?",
            "מה רואים כשמסתכלים במראה?",
            "איזה מאכל חולי צליאק יכולים לאכול?",
            "מה הסלוגן של המוסד?",
            "מה ראשי התיבות או\"ם?",
            "עם איזה מכשיר מתגלחים?",
            "מה ההבדל בין ברבור לאווז?",
            "למה מחליפים מצערים?",
            "מי גילה את אמריקה?",
            "מפני מה מגן קרם הגנה?",
            "איפה כריש חי?",
            "מה הגיוני ללבוש להלוויה?",
            "השלימי: \"תפסת מרובה...\"?",
            "מה לומדים באוניברסיטה?",
            "מה מייצר הלבנה?",
            "ציין אחד משבטי ישראל",
            "ממה מכינים פלאפל?",
            "תני טעם נפוץ של ארטיק",
            "\"יום הולדת, חגיגה...\"?",
            "מה יוצא אם משפשפים מנורה?",
            "מה הטלפון של המשטרה?",
            "תן שם של זמר אופרה מפורסם",
            "לאיזה בעל חיים יש שמונה זרועות?",
            "איך קוראים לאיש שמכבה שריפות?",
            "תני סוג של אגוז",
            "מה אפשר לקנות בטמבוריה?",
            "איזה משקל הגיוני להרים עם היד?",
            "איך יודעים שבא אביב?",
            "איזה וירוס התחיל את המגפה ב-2020?",
            "לאיזו חיה יש צוואר ארוך?",
            "מה לגיטימי להגיד לילד שחוגג בר מצווה?",
            "איזו עיר בירה אינה באירופה?",
            "איזו שפה מדברים בפורטוגל?",
            "איך קוראים לממציא הדינמיט?",
            "כמה ימים יש בפברואר?",
            "מה מייצרת חברת קוקה קולה?",
            "איך קוראים לכלב של מיקי מאוס?",
            "האם יש חייזרים?",
            "איפה נמצאות הפירמידות?",
            "איך קוראים למשחק הקופסה הזה?",
            "תן שם של מאכל איטלקי",
            "איך אומרים \"דג\" באמהרית?",
            "מה פו הדב אוהב לאכול?",
            "מה שמים בצלחת פסח?",
            "מה יקרה אם תסתכלי ישירות לתוך השמש?",
            "כמה עולה לשחרר עגלת סופר?",
            "ולכן לשחרר שלוש עגלות סופר עולה...?",
            "ציין שם של מלון בטבריה",
            "מה גזרו לשמשון הגיבור?",
            "איזה דגל מסמל דחייה אסורה?",
            "איזה מאכל הגיוני למצוא בסופר?",
            "מה עושים עם קוץ בטוסיק?",
            "מה יוצא דופן בין ריבוע, משולש ועיגול?",
            "בשם איזו מדינה יש את האות י'?",
            "אם אני עומד מצד ימין שלך, באיזה צד שלי אתה עומד?",
            "מה גורם למגנטים להתנגד?",
            "מה לא עושים בצום?",
            "תן מדינה שאין לה גבול ימי",
            "תדגימי בדיאלקט",
            "למה אסור לחלק באפס?",
            "מאיזו מדינה הגיע הבורשט?",
            "תני שם של אויב של באטמן",
            "באיזה שם של מדינה יש את האות א'?",
            "מה עושים באמבולנס?",
            "איך הגיוני להרוג נחש?",
            "כמה פינות יש לכובע שלי?",
            "מה מחיר דירה ממוצעת בישראל?",
            "מה מפיקים בבנק?",
            "מה ראשי התיבות WWW?",
            "מה המספר שבא אחרי 245?",
            "תן שיר של אביב גפן",
            "איך עושה נחש?",
            "באיזה אור ברמזור עוצרים?",
            "מה זה מספר ראשוני?",
            "תני דוגמה למספר ראשוני",
            "איך נקראת הפעולה של קטיפת תמרים?",
            "במה עסק נתן אלתרמן?",
            "צייני דמות חשובה מסרטי מלחמת הכוכבים"
        ];
        const examplesAsText = exampleQuestions.map((q, index) => `${index + 1}. ${q}`).join('\n');

        const finalPrompt = `אתה עוזר ביצירת שאלות טריוויה בעברית  .

        אלו הן דוגמאות לסגנון השאלות שאני מחפש:
        ${examplesAsText}

        עכשיו, בהתבסס על הדוגמאות, צור שאלה אחת בלבד מקורית באותו הסגנון. ודא שהיא בעברית ומבוססת על עובדות אמיתיות.
        תן רק את השאלה. בלי שום הקדמה או סיום . 
        במידה ואתה נותן מספר שאלות, תביא רק את הראשונה!!
        `;

        const MODEL_NAME = "gemini-2.0-flash-lite";
        const API_KEY = process.env.GOOGLE_API_KEY;

        const url = `https://generativelanguage.googleapis.com/v1/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        const requestBody = {
            "contents": [{
                "parts": [{
                    "text": finalPrompt
                }]
            }]
        };

        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(requestBody)
        });

        if (!response.ok) {
            const errorData = await response.json();
            console.error("Google API Error:", errorData);
            // It's better to return a proper response object here
            return NextResponse.json({ error: `API Error: ${response.status} ${JSON.stringify(errorData)}` }, { status: response.status });
        }

        const data = await response.json();

        if (!data.candidates || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0].text) {
            return NextResponse.json({ error: "Invalid response structure from Google API" }, { status: 500 });
        }

        const questionContent = data.candidates[0].content.parts[0].text;

        return NextResponse.json({ question: questionContent });

    } catch (error) {
        console.error(error);
        return NextResponse.json({ error: 'Failed to create question' }, { status: 500 });
    }
}